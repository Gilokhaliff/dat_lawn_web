const translations = {
  en: {
    brand_subtitle: "Pro-grade gear, tested weekly",
    nav_home: "Home",
    nav_bundles: "Bundles",
    nav_catalog: "Catalog",
    nav_why: "Why me",
    nav_reviews: "Reviews",
    nav_checklist: "Checklist",
    nav_faq: "FAQ",
    nav_cta: "Get a recommendation",
    hero_tagline: "Working greenkeeper • Documented picks",
    hero_heading: "Precision lawn gear, tested and recorded.",
    hero_lead:
      "Active lawn work, not a showroom: the exact tools, applications, and video workflow I use. Clear rates, safety notes, and a standing 5% Rasenwelt code (datlawncode5) for anything you add.",
    hero_primary_cta: "View catalog",
    hero_secondary_cta: "Get a recommendation",
    chip1: "Field-tested selections",
    chip2: "Safety notes + rates",
    chip3: "Find me on Instagram",
    hero_card_text:
      "<strong>Weekly routes.</strong> Everything listed and pictured rides in my truck. No filler, just what survives real lawns.",
    stat1_label: "lawn freaks influenced",
    stat2_label: "certified tools",
    stat3_label: "reply on DMs",
    strip_seen: "Field work",
    strip_seen_list: "Active greenkeeper, weekly routes",
    strip_tested: "Community",
    strip_tested_list: "25k+ lawn freaks learning together",
    strip_guarantee: "Transparency",
    strip_guarantee_list: "No paid hype, only what I use",
    promo_pill: "Ongoing perk",
    promo_heading: "5% off every Rasenwelt product",
    promo_sub: "Use my code on any Rasenwelt item, anytime.",
    promo_band_text: "5% off every Rasenwelt product • Code: datlawncode5 • No expiry",
    promo_code_label: "Code",
    promo_cta: "Shop Rasenwelt",
    bundles_pill: "Featured bundles",
    bundles_heading: "Ready-to-go kits for fast wins",
    bundles_sub: "Grab a kit that matches your yard. Each bundle has the exact tools and products I use with clients.",
    bundles_cta: "Need a custom kit?",
    bundle1_title: "Starter Stripe Kit",
    bundle1_desc: "Get clean cuts and light striping on most cool-season lawns.",
    bundle1_li1: "Pro reel or rotary mower pick",
    bundle1_li2: "Edge + trim basics",
    bundle1_li3: "First-feed fertilizer (pet safe)",
    bundle1_li4: "Hose-end sprayer & surfactant",
    bundle1_btn: "Build this kit",
    bundle2_title: "Pro Striping Kit",
    bundle2_desc: "For the neighbors-stare lawns: higher nitrogen, roller, and foliar touches.",
    bundle2_li1: "Stripe roller attachment",
    bundle2_li2: "Fast-release foliar feed",
    bundle2_li3: "Selective weed control",
    bundle2_li4: "Soil probe & pH tester",
    bundle2_btn: "Book a consult",
    bundle3_title: "Season Rescue",
    bundle3_desc: "Fix thin spots or bounce back after heat with a one-month plan.",
    bundle3_li1: "Aeration + overseed picks",
    bundle3_li2: "Starter fert + watering plan",
    bundle3_li3: "Fungus watch list",
    bundle3_li4: "Follow-up coaching DM",
    bundle3_btn: "I want this",
    catalog_pill: "Catalog",
    catalog_heading: "Everything I actually use",
    catalog_sub: "Tools, consumables, ebooks, and seasonal picks. Tap through to purchase - affiliate links where noted.",
    catalog_btn: "Talk with me",
    group1_title: "Tools I use",
    group1_sub: "Mowers, trimmers, edging, soil probes.",
    group2_title: "Consumables",
    group2_sub: "Fertilizers, weed control, surfactants.",
    group5_title: "Professional video gear",
    group5_sub: "What I use to film kits, demos, and guides.",
    group3_title: "Ebooks & Guides",
    group3_sub: "Instant downloads with step-by-step plans.",
    group4_title: "Seasonal picks",
    group4_sub: "What I’m using right now for the weather.",
    highlights_pill: "Why trust these picks",
    highlights_heading: "Field-tested gear from an active greenkeeper",
    why_logo_title: "DAT LAWN GUY",
    why_logo_sub: "Field notes, not fluff",
    why_quote: "Field-tested notes from weekly routes - what survives real lawns.",
    why_intro:
      "I don’t just film lawn care - I live it. I test, experiment, make mistakes, learn, and show openly what actually works - not what marketing teams want to sell.",
    why_para:
      "Everything here comes from real practice: irrigation, overseeding, fertilizer strategies, troubleshooting, care plans, and full transformations from “meh” to premium turf.",
    why_point1: "A growing community and brand partners, but recommendations stay honest: only what makes sense.",
    why_point2: "No hype, no miracle products. Clear steps, transparent explanations, modern solutions.",
    why_point3: "If you take lawn care seriously and want results, you’re in the right place.",
    why_outro: "Looking for someone who treats lawn care like a craft and shares it plainly? Let’s get your turf there.",
    why_stat1_label: "Routes per week",
    why_stat2_label: "Rasenwelt code",
    why_stat3_label: "Community",
    why_tag1: "Unpaid picks",
    why_tag2: "Photo + video proof",
    why_tag3: "Safety + rates noted",
    testimonials_pill: "Testimonials",
    testimonials_heading: "Lawns that made the block stop",
    testimonials_sub: "Real results from people who followed these kits and guides.",
    reviews_pill: "Reviews",
    reviews_heading: "Leave a note for the next lawn nerd",
    reviews_sub: "Share how the kits or guides worked for you. Fresh feedback keeps this list honest.",
    reviews_form_title: "Leave a comment",
    reviews_label_name: "Name",
    reviews_label_comment: "Comment",
    reviews_placeholder_name: "Your name or initials",
    reviews_placeholder_comment: "What changed for your lawn?",
    reviews_label_rating: "Rating",
    reviews_button: "Post comment",
    reviews_status: "Thanks! Your comment is live.",
    reviews_empty: "No reviews yet. Be the first.",
    newsletter_pill: "Weekly checklist",
    newsletter_heading: "Get my Sunday prep email",
    newsletter_sub: "What to spray, mow height, and weather notes - one email each week.",
    newsletter_placeholder: "you@email.com",
    newsletter_button: "Send me the checklist",
    newsletter_status: "Checklist is on the way. Check your inbox.",
    faq_pill: "FAQ",
    faq_heading: "Answers before you buy",
    contact_pill: "Contact",
    contact_heading: "Need a personalized kit?",
    contact_sub: "Tell me about your lawn and budget. I’ll reply within 48 hours.",
    contact_cta_call: "Email",
    contact_cta_email: "Email",
    contact_how_title: "How it works",
    contact_how_li1: "Share lawn size, sun/shade, and goals.",
    contact_how_li2: "I recommend tools/products with links.",
    contact_location: "Location: Brunswick, Lower Saxony, Germany.",
    contact_form_title: "Quick note",
    contact_label_name: "Name",
    contact_label_contact: "Email",
    contact_label_message: "What do you need?",
    contact_placeholder_name: "Your name",
    contact_placeholder_contact: "you@email.com",
    contact_placeholder_message: "Starter kit, striping, weed rescue...",
    contact_form_btn: "Send",
    contact_status: "Got it! Expect a reply within 48 hours.",
    footer_brand_sub: "Pro-grade gear, tested weekly",
    footer_note: "Affiliate links may earn a commission. I only list what I use on real lawns.",
    footer_location: "Based in Brunswick, Lower Saxony, Germany.",
    footer_shortcuts_title: "Shortcuts",
    footer_contact_title: "Contact",
    footer_legal_title: "Details",
    footer_legal_line1: "Professional greenkeeper sharing field-tested picks.",
    footer_legal_line2: "Registered in Germany; no paid placements.",
    footer_legal_note: "For legal and privacy inquiries, email me.",
    footer_copyright: "© 2025 DAT LAWN GUY. All rights reserved.",
    footer_disclaimer: "For the latest rates or policies, contact datlawnguy0@gmail.com.",
    shortcut_bundles: "Bundles",
    shortcut_catalog: "Catalog",
    shortcut_checklist: "Checklist",
    shortcut_faq: "FAQ",
    shortcut_form: "Form",
    tag_affiliate: "Affiliate",
    tag_prop: "Pro pick",
    tag_must: "Must",
    tag_pet: "Pet safe",
    tag_cool: "Cool season",
    tag_time: "Timing critical",
    tag_spot: "Spot treat",
    tag_eff: "Efficiency",
    tag_org: "Organic",
    tag_now: "Now",
    tag_fall: "Fall",
    tag_pdf: "PDF",
    product_view: "View",
    product_buy: "Buy now",
    ebook_pill: "Ebook",
    ebook_title: "Spring lawn care without the BS",
    ebook_lead: "A 6-week, no-nonsense plan for dense, green turf between March and May.",
    ebook_highlight1: "Step-by-step for 6 weeks: prep, seed, feed, water, mow.",
    ebook_highlight2: "Simple gear + rates; avoid common mistakes.",
    ebook_highlight3: "Direct download after purchase.",
    ebook_contents_title: "What you’ll get",
    ebook_ch1_title: "Intro",
    ebook_ch1_body: "Why spring lawns fail and how a simple 6-week reset fixes it without jargon.",
    ebook_ch2_title: "Weeks 1–2: Prep",
    ebook_ch2_body: "Check pH, clear winter debris, first cut, and loosen compaction so everything later works.",
    ebook_ch3_title: "Weeks 3–4: Seed & feed",
    ebook_ch3_body: "Aerate, overseed with the right mix, add starter fertilizer, and keep even moisture.",
    ebook_ch4_title: "Weeks 5–6: Routine",
    ebook_ch4_body: "Dial in mowing height, deep watering, and a second feed to lock in density.",
    ebook_ch5_title: "Quick fixes",
    ebook_ch5_body: "Fast answers for short cuts, watering mistakes, and fertilizer mishaps.",
    ebook_highlights_title: "Why it’s useful",
    ebook_contact_title: "Need help?",
    ebook_contact_desc: "Questions about fit, timing, or tools? Message me before you buy.",
    ebook_back: "Back to catalog",
    ebook_buy_button: "Buy now",
    ebook_buy_button_price: "Buy now (€29.99)",
    ebook_contact: "Questions? Message me",
    ebook_offer_pill: "Ready for thick green?",
    ebook_offer_heading: "Get the 6-week plan",
    ebook_offer_sub: "PDF, checklists, links, and bonus videos—instant download.",
    ebook_offer_price: "€29.99",
    ebook_offer_safety: "Secure checkout · VAT incl. · Instant download",
  },
  de: {
    brand_subtitle: "Profi-Rasen-Equipment, jede Woche getestet",
    nav_home: "Startseite",
    nav_bundles: "Bundles",
    nav_catalog: "Katalog",
    nav_why: "Warum ich",
    nav_reviews: "Bewertungen",
    nav_checklist: "Checkliste",
    nav_faq: "FAQ",
    nav_cta: "Empfehlung anfordern",
    hero_tagline: "Greenkeeper im Einsatz • Dokumentierte Picks",
    hero_heading: "Präzises Rasen-Equipment, geprüft und festgehalten.",
    hero_lead:
      "Aktive Arbeit, kein Showroom: Genau die Tools, Anwendungen und Video-Workflows, die ich nutze. Klare Mengen, Sicherheits-Hinweise und der 5%-Code datlawncode5 für alles bei Rasenwelt.",
    hero_primary_cta: "Katalog ansehen",
    hero_secondary_cta: "Empfehlung anfragen",
    chip1: "Praxisgetestete Auswahl",
    chip2: "Sicherheit + Mengenangaben",
    chip3: "Finde mich auf Instagram",
    hero_card_text:
      "<strong>Wöchentliche Touren.</strong> Die gelisteten und gezeigten Tools liegen in meinem Truck. Kein Schnickschnack, nur was echte Gärten überlebt.",
    stat1_label: "Lawn Freaks erreicht",
    stat2_label: "Zertifizierte Tools",
    stat3_label: "Antwortzeit per DM",
    strip_seen: "Praxis",
    strip_seen_list: "Aktiver Greenkeeper, wöchentliche Touren",
    strip_tested: "Community",
    strip_tested_list: "25k+ Lawn Freaks lernen mit",
    strip_guarantee: "Transparenz",
    strip_guarantee_list: "Keine gekaufte Werbung, nur was ich nutze",
    promo_pill: "Dauerhafter Vorteil",
    promo_heading: "5% auf jedes Rasenwelt-Produkt",
    promo_sub: "Code für jedes Rasenwelt-Teil, jederzeit nutzbar.",
    promo_band_text: "5% auf jedes Rasenwelt-Produkt • Code: datlawncode5 • Kein Ablaufdatum",
    promo_code_label: "Code",
    promo_cta: "Rasenwelt shoppen",
    bundles_pill: "Empfohlene Bundles",
    bundles_heading: "Fertige Kits für schnelle Erfolge",
    bundles_sub:
      "Such dir das passende Set für deinen Garten. Jedes Bundle enthält genau die Tools und Produkte, die ich beim Kunden nutze.",
    bundles_cta: "Brauche ein individuelles Kit",
    bundle1_title: "Starter Stripe Kit",
    bundle1_desc: "Saubere Schnitte und leichte Streifen für kühle Saisonrasen.",
    bundle1_li1: "Spindel- oder Sichelmäher-Empfehlung",
    bundle1_li2: "Basics für Kanten & Trimmen",
    bundle1_li3: "Startdünger (haustierfreundlich)",
    bundle1_li4: "Schlauch-Sprüher & Netzmittel",
    bundle1_btn: "Dieses Kit zusammenstellen",
    bundle2_title: "Pro Striping Kit",
    bundle2_desc: "Für Hingucker-Rasen: höherer Stickstoff, Walze und Blattdünger.",
    bundle2_li1: "Streifen-Walze",
    bundle2_li2: "Schnell wirkender Blattdünger",
    bundle2_li3: "Selektiver Unkrautstopp",
    bundle2_li4: "Bodenbohrer & pH-Tester",
    bundle2_btn: "Beratung buchen",
    bundle3_title: "Season Rescue",
    bundle3_desc: "Lichtes Gras auffüllen oder nach Hitze regenerieren - Plan für 1 Monat.",
    bundle3_li1: "Aeration + Nachsaat Empfehlungen",
    bundle3_li2: "Starterdünger + Bewässerungsplan",
    bundle3_li3: "Pilz-Checkliste",
    bundle3_li4: "Follow-up Coaching per DM",
    bundle3_btn: "Will ich haben",
    catalog_pill: "Katalog",
    catalog_heading: "Alles, was ich wirklich nutze",
    catalog_sub:
      "Werkzeuge, Verbrauchsmaterial, Ebooks und Saisontipps. Klick zum Händler - Affiliate-Links sind gekennzeichnet.",
    catalog_btn: "Sprich mit mir",
    group1_title: "Werkzeug, das ich nutze",
    group1_sub: "Mäher, Trimmer, Kanten, Bodenproben.",
    group2_title: "Verbrauchsmaterial",
    group2_sub: "Dünger, Unkrautkontrolle, Netzmittel.",
    group5_title: "Pro-Video-Equipment",
    group5_sub: "Was ich für Kit-Videos, Demos und Guides nutze.",
    group3_title: "Ebooks & Guides",
    group3_sub: "Sofort-Downloads mit Schritt-für-Schritt-Plänen.",
    group4_title: "Saisonale Picks",
    group4_sub: "Was ich aktuell wegen Wetter nutze.",
    highlights_pill: "Darum diese Picks",
    highlights_heading: "Praxisgeprüftes Equipment vom aktiven Greenkeeper",
    why_logo_title: "DAT LAWN GUY",
    why_logo_sub: "Feldnotizen statt Floskeln",
    why_quote: "Feldnotizen von wöchentlichen Routen - was echte Rasen überlebt.",
    why_intro:
      "Ich filme Rasenpflege nicht nur - ich lebe sie. Ich teste, experimentiere, mache Fehler, lerne daraus und zeige offen, was wirklich funktioniert - nicht das, was Marketing gern verkaufen würde.",
    why_para:
      "Alles hier kommt aus echter Praxis: Bewässerung, Nachsaat, Dünge-Strategien, Problembehebung, Pflegepläne und komplette Transformationen vom „na ja“-Rasen zum Premium-Rasen.",
    why_point1: "Wachsende Community und Partner, aber Empfehlungen bleiben ehrlich: nur was Sinn ergibt.",
    why_point2: "Kein Hype, keine Wunderprodukte. Klare Schritte, transparente Erklärungen, moderne Lösungen.",
    why_point3: "Wenn du Rasenpflege ernst nimmst und Ergebnisse willst, bist du hier richtig.",
    why_outro: "Du suchst jemanden, der Rasenpflege als Handwerk sieht und verständlich teilt? Dann lass uns deinen Rasen dorthin bringen.",
    why_stat1_label: "Routen pro Woche",
    why_stat2_label: "Rasenwelt-Code",
    why_stat3_label: "Community",
    why_tag1: "Unbezahlte Picks",
    why_tag2: "Foto + Video-Belege",
    why_tag3: "Sicherheit + Mengenangaben",
    testimonials_pill: "Stimmen",
    testimonials_heading: "Rasen, die auffallen",
    testimonials_sub: "Echte Ergebnisse von Leuten, die diesen Plänen folgen.",
    reviews_pill: "Bewertungen",
    reviews_heading: "Hinterlass einen Kommentar für die Crew",
    reviews_sub: "Teile, wie Kits oder Guides funktioniert haben. Frisches Feedback hält die Liste ehrlich.",
    reviews_form_title: "Kommentar schreiben",
    reviews_label_name: "Name",
    reviews_label_comment: "Kommentar",
    reviews_placeholder_name: "Dein Name oder Initialen",
    reviews_placeholder_comment: "Was hat sich auf deinem Rasen verändert?",
    reviews_label_rating: "Bewertung",
    reviews_button: "Kommentar posten",
    reviews_status: "Danke! Dein Kommentar ist live.",
    reviews_empty: "Noch keine Bewertungen. Sei die erste.",
    newsletter_pill: "Wochen-Checkliste",
    newsletter_heading: "Hol dir meine Sonntags-Mail",
    newsletter_sub: "Was sprühen, Schnitthöhe, Wetterhinweise - eine Mail pro Woche.",
    newsletter_placeholder: "du@email.de",
    newsletter_button: "Schick mir die Checkliste",
    newsletter_status: "Checkliste ist unterwegs. Bitte Postfach prüfen.",
    faq_pill: "FAQ",
    faq_heading: "Antworten vor dem Kauf",
    contact_pill: "Kontakt",
    contact_heading: "Braucht dein Rasen ein Kit?",
    contact_sub: "Erzähl mir von Fläche und Budget. Antwort in 48 Stunden.",
    contact_cta_call: "E-Mail",
    contact_cta_email: "E-Mail",
    contact_how_title: "So läuft es",
    contact_how_li1: "Teile Fläche, Sonne/Schatten und Ziele.",
    contact_how_li2: "Ich empfehle Tools/Produkte mit Links.",
    contact_location: "Region: Braunschweig, Niedersachsen, Deutschland.",
    contact_form_title: "Kurz notieren",
    contact_label_name: "Name",
    contact_label_contact: "E-Mail",
    contact_label_message: "Was brauchst du?",
    contact_placeholder_name: "Dein Name",
    contact_placeholder_contact: "du@email.de",
    contact_placeholder_message: "Starter-Kit, Streifen, Unkraut-Rescue...",
    contact_form_btn: "Senden",
    contact_status: "Danke! Antwort folgt innerhalb von 48 Stunden.",
    footer_brand_sub: "Profi-Rasen-Equipment, jede Woche getestet",
    footer_note: "Affiliate-Links bringen Provision. Ich liste nur, was ich selbst nutze.",
    footer_location: "Sitz: Braunschweig, Niedersachsen, Deutschland.",
    footer_shortcuts_title: "Shortcuts",
    footer_contact_title: "Kontakt",
    footer_legal_title: "Details",
    footer_legal_line1: "Greenkeeper im Einsatz, praxisgeprüfte Empfehlungen.",
    footer_legal_line2: "Registriert in Deutschland; keine bezahlten Platzierungen.",
    footer_legal_note: "Für rechtliche oder Datenschutz-Anfragen: schreib mir.",
    footer_copyright: "© 2025 DAT LAWN GUY. Alle Rechte vorbehalten.",
    footer_disclaimer: "Für aktuelle Konditionen oder Richtlinien: datlawnguy0@gmail.com.",
    shortcut_bundles: "Bundles",
    shortcut_catalog: "Katalog",
    shortcut_checklist: "Checkliste",
    shortcut_faq: "FAQ",
    shortcut_form: "Formular",
    tag_affiliate: "Affiliate",
    tag_prop: "Profi-Auswahl",
    tag_must: "Pflicht",
    tag_pet: "Haustierfreundlich",
    tag_cool: "Kühle Saison",
    tag_time: "Timing wichtig",
    tag_spot: "Gezielte Behandlung",
    tag_eff: "Effizienz",
    tag_org: "Bio",
    tag_now: "Jetzt",
    tag_fall: "Herbst",
    tag_pdf: "PDF",
    product_view: "Ansehen",
    product_buy: "Jetzt kaufen",
    ebook_pill: "Ebook",
    ebook_title: "Frühling Rasenpflege ohne Bullshit",
    ebook_lead: "Ein 6-Wochen-Plan für dichten, grünen Rasen – klar, praxisnah, ohne Fachchinesisch.",
    ebook_highlight1: "Schritt-für-Schritt für 6 Wochen: Vorbereitung, Saat, Düngung, Bewässerung, Mähen.",
    ebook_highlight2: "Einfache Tools + Mengen; typische Fehler vermeiden.",
    ebook_highlight3: "Direkter Download nach dem Kauf.",
    ebook_contents_title: "Was drin ist",
    ebook_ch1_title: "Intro",
    ebook_ch1_body: "Warum Frühjahrsrasen scheitern und wie ein klarer 6-Wochen-Reset das ohne Fachchinesisch löst.",
    ebook_ch2_title: "Woche 1–2: Vorbereitung",
    ebook_ch2_body: "pH prüfen, Winterreste runter, erster Schnitt, Verdichtung lösen – Basis schaffen, damit alles greift.",
    ebook_ch3_title: "Woche 3–4: Saat & Startdünger",
    ebook_ch3_body: "Lüften/aerifizieren, richtig nachsäen, Starterdünger geben und Feuchte gleichmäßig halten.",
    ebook_ch4_title: "Woche 5–6: Routine",
    ebook_ch4_body: "Schnitthöhe einstellen, tief wässern, zweite Düngung setzen – so wird der Rasen dicht.",
    ebook_ch5_title: "Soforthilfe",
    ebook_ch5_body: "Kurz und knapp bei Fehlern: zu kurz gemäht, falsches Gießen, Dünger-Pannen schnell beheben.",
    ebook_highlights_title: "Warum hilfreich",
    ebook_contact_title: "Brauchst du Hilfe?",
    ebook_contact_desc: "Fragen zu Timing, Werkzeug oder ob es passt? Schreib mir vor dem Kauf.",
    ebook_back: "Zurück zum Katalog",
    ebook_buy_button: "Jetzt kaufen",
    ebook_buy_button_price: "Jetzt kaufen (29,99 €)",
    ebook_contact: "Fragen? Schreib mir",
    ebook_offer_pill: "Bereit für sattes Grün?",
    ebook_offer_heading: "Hol dir den 6-Wochen-Plan",
    ebook_offer_sub: "E-Book (PDF), Checklisten, Links & Bonusvideos – sofort verfügbar.",
    ebook_offer_price: "29,99 €",
    ebook_offer_safety: "Sicherer Checkout · inkl. MwSt. · Sofortdownload",
  },
};

const products = {
  tools: [
    {
      name: { en: "Reel mower", de: "Spindelmäher" },
      note: {
        en: "Crisp, scissor-like cut for cool-season turf with a low noise footprint. Great when you want pro-looking stripes and even height without scalping.",
        de: "Sauberer Scherenschnitt für kühle Saisonrasen bei wenig Lärm. Ideal für Profi-Streifen und gleichmäßige Schnitthöhe ohne Schälstellen.",
      },
      tagKey: "tag_affiliate",
      link: "https://amzn.to/45SlreB",
      image: "images/tools/al-ko.webp",
      price: "$",
    },
    {
      name: { en: "Rotary mower w/ striping kit", de: "Sichelmäher mit Streifen-Kit" },
      note: {
        en: "Rotary deck with a striping kit for fast, forgiving mowing. Gives you visible stripes without risking scalps on bumpy lawns.",
        de: "Sichelmäher mit Streifen-Kit für schnelles, fehlertolerantes Mähen. Sichtbare Streifen ohne Schälgefahr auf unruhigen Flächen.",
      },
      tagKey: "tag_affiliate",
      link: "#",
      image: "images/tools/rotary-striping.jpg",
      price: "$$",
    },
    {
      name: { en: "Battery string trimmer", de: "Akku-Fadentrimmer" },
      note: {
        en: "Quiet edging with quick-load spool for fast string changes. Light enough for long sessions but strong enough to clean up curbs and beds.",
        de: "Leises Kanten mit Schnellspule für fixen Fadenwechsel. Leicht für längere Einsätze, kräftig genug für Bordsteine und Beete.",
      },
      tagKey: "tag_affiliate",
      link: "https://amzn.to/496Ye8P",
      image: "images/tools/fadentrimmer.jpg",
      price: "$",
    },
    {
      name: { en: "Lawn aerator", de: "Aerifizierer" },
      note: {
        en: "Pulls clean cores so air, water, and fertilizer reach the roots fast. Comes with a catcher, so you stay tidy while relieving compaction.",
        de: "Zieht saubere Kerne, damit Luft, Wasser und Dünger schnell zu den Wurzeln gelangen. Mit Auffangbehälter, damit du beim Entlasten der Verdichtung sauber bleibst.",
      },
      tagKey: "tag_must",
      link: "https://www.rasenwelt.de/products/arena-aerifizierer-mit-auffangbehalter",
      image: "images/tools/aerifizierer.jpg",
      imageClass: "aerator-compact",
      price: "$$",
    },
    {
      name: { en: "Hand spreader", de: "Handstreuer" },
      note: {
        en: "Quick for spot seeding and light granular passes without hauling a big spreader. Great for tight beds, patches, and slopes.",
        de: "Schnell für Nachsaat und leichte Granulat-Gaben ohne großen Streuwagen. Perfekt für enge Beete, Kahlstellen und Hänge.",
      },
      tagKey: "tag_affiliate",
      link: "https://amzn.to/4nElb9h",
      image: "images/tools/handstreuer.jpg",
      price: "$",
    },
    {
      name: { en: "GARDENA garden hose", de: "GARDENA Gartenschlauch" },
      note: {
        en: "Tangle-free hose with solid fittings that don’t leak. Stays flexible in cool temps and works well on reels.",
        de: "Verdrillfreier Schlauch mit dichten, soliden Anschlüssen. Bleibt auch bei kühleren Temperaturen flexibel und läuft gut auf Schlauchtrommeln.",
      },
      tagKey: "tag_affiliate",
      link: "https://amzn.to/45SwSTD",
      image: "images/tools/gardena-schlauch.jpg",
      imageClass: "hose-compact",
      price: "$$",
    },
    {
      name: { en: "Leaf blower", de: "Laubbläser" },
      note: {
        en: "Cordless blower that clears clippings fast without dragging cords. Variable speed lets you handle beds gently or blast hard surfaces.",
        de: "Kabelloser Bläser, der Schnittgut schnell entfernt, ohne Kabelsalat. Variable Geschwindigkeit für schonende Beetarbeit oder kraftvolles Reinigen von Flächen.",
      },
      tagKey: "tag_affiliate",
      link: "https://amzn.to/3V64G9I",
      image: "images/tools/laubblaeser.jpg",
      price: "$$",
    },
    {
      name: { en: "Battery chain saw", de: "Akku-Kettensäge" },
      note: {
        en: "Battery saw for fast limb cleanup without mixing fuel. Tool-free chain tensioning makes on-the-go adjustments easy.",
        de: "Akkusäge für schnelles Ast-Handling ohne Benzinmischung. Werkzeuglose Kettenspannung für schnelle Anpassungen unterwegs.",
      },
      tagKey: "tag_affiliate",
      link: "https://amzn.to/3Id37Ur",
      image: "images/tools/saege.jpg",
      imageClass: "saw-compact",
      price: "$$",
    },
  ],
  consumables: [
    {
      name: { en: "Starter fertilizer 10-15-10", de: "Starterdünger 10-15-10" },
      note: {
        en: "Starter NPK 10-15-10 that pushes roots fast after seed. Pet-safe once dry; pairs with light, even watering.",
        de: "Starter-NPK 10-15-10 für schnellen Wurzelaufbau nach der Saat. Haustierfreundlich nach Trocknung; funktioniert am besten mit gleichmäßiger Bewässerung.",
      },
      tagKey: "tag_pet",
      link: "https://www.rasenwelt.de/products/starterdunger-arena-starter-10-15-10-25kg",
      image: "images/consumables/starterduenger_arena.png",
      price: "$",
    },
    {
      name: { en: "Summer fertilizer 24-6-12 (+3+1)", de: "Sommerdünger 24-6-12 (+3+1)" },
      note: {
        en: "Balanced 24-6-12 with extra minors for summer strength—keeps color without pushing top growth. Ideal mid-season feed when temps climb.",
        de: "Ausgewogener 24-6-12 mit Mikros für sommerliche Stärke – hält die Farbe, ohne zu viel Blattmasse zu schieben. Perfekt als Mid-Season-Gabe bei wärmeren Temperaturen.",
      },
      tagKey: "tag_now",
      link: "https://www.rasenwelt.de/products/sommerdunger-arena-pacemaker-ii-24-6-12-3-1-8kg",
      image: "images/consumables/sommerduenger_arena.png",
      price: "$$",
    },
    {
      name: { en: "Fall fertilizer 10-0-21 (+6 MgO)", de: "Herbstdünger 10-0-21 (+6 MgO)" },
      note: {
        en: "High-K 10-0-21 with magnesium to harden turf before winter. Builds stress resistance and keeps color deeper into fall.",
        de: "Kaliumstarker 10-0-21 mit Magnesium, um den Rasen vor dem Winter abzuhärten. Steigert die Stressresistenz und hält die Farbe länger im Herbst.",
      },
      tagKey: "tag_fall",
      link: "https://www.rasenwelt.de/products/herbstdunger-arena-striker-mini-25-kg",
      image: "images/consumables/herbstduenger_arena.png",
      price: "$$",
    },
    {
      name: { en: "Slow-release 6-2-5", de: "Langzeitdünger 6-2-5" },
      note: {
        en: "Slow-release 6-2-5 for steady color without growth spikes. Ideal as a monthly base feed in spring and summer.",
        de: "Langzeit-6-2-5 für stabile Farbe ohne Wachstumsschübe. Ideal als monatliche Grundgabe im Frühling und Sommer.",
      },
      tagKey: "tag_cool",
      link: "https://www.rasenwelt.de/products/compo-expert-terraplus-citygreen-6-2-5",
      image: "images/consumables/langzeitduenger.png",
      price: "$",
    },
    {
      name: { en: "Lawn seed (Poa supina)", de: "Rasensamen (Poa supina)" },
      note: {
        en: "Shade-tolerant Poa supina for tough spots and overseed. Great for north-facing or tree-heavy lawns needing durable coverage.",
        de: "Schattenverträgliche Poa supina für schwierige Flächen und Nachsaat. Ideal für Nordlagen oder baumreiche Gärten mit hohem Anspruch an Strapazierfähigkeit.",
      },
      tagKey: "tag_cool",
      link: "https://www.rasenwelt.de/products/arena-poa-supina-superior",
      image: "images/consumables/poa-supina.png",
      price: "$$",
    },
    {
      name: { en: "Selective herbicide", de: "Unkrautvernichter" },
      note: {
        en: "Selective weed control that targets broadleaf weeds while sparing turf. Best on a dry lawn with no rain forecast for a few hours.",
        de: "Selektives Mittel gegen breitblättrige Unkräuter, schont den Rasen. Am besten auf trockenem Rasen ausbringen, ohne Regen in den nächsten Stunden.",
      },
      tagKey: "tag_spot",
      link: "https://amzn.to/4pWQuNZ",
      image: "images/consumables/compo_unkrautvernichter.jpg",
      price: "$",
    },
    {
      name: { en: "Soil improver", de: "Bodenverbesserer" },
      note: {
        en: "Loosens compacted soil, boosts biology, and helps nutrients move. Ideal ahead of seed or as a spring tune-up for tired soil.",
        de: "Lockert verdichteten Boden, stärkt die Biologie und verbessert den Nährstofffluss. Ideal vor der Saat oder als Frühjahrskur für müde Böden.",
      },
      tagKey: "tag_org",
      link: "https://amzn.to/4jjMC7l",
      image: "images/consumables/bodenaktivator.jpg",
      price: "$$",
    },
    {
      name: { en: "Lawn soil mix", de: "Rasenerde" },
      note: {
        en: "Fine lawn soil for topdressing thin spots and leveling. Improves seed-to-soil contact and moisture retention after overseeding.",
        de: "Feine Rasenerde zum Topdressen von Lücken und zum Ausgleichen. Verbessert Bodenkontakt und Feuchtehaltung nach der Nachsaat.",
      },
      tagKey: "tag_org",
      link: "https://amzn.to/4jhmEkM",
      image: "images/consumables/compo_rasenerde.jpg",
      price: "$$",
    },
  ],
  videoGear: [
    {
      name: { en: "Sony ZV-E10 II (4K mirrorless)", de: "Sony ZV-E10 II (4K Systemkamera)" },
      note: {
        en: "Clean 4K/60 from Sony’s ZV-E10 II for kit demos and close-ups. Fast autofocus and solid low-light make morning/dusk shoots easy.",
        de: "Sauberes 4K/60 mit der Sony ZV-E10 II für Kit-Demos und Nahaufnahmen. Schneller Autofokus und gute Low-Light-Performance für Morgen- oder Abenddrehs.",
      },
      tagKey: "tag_affiliate",
      link: "https://amzn.to/3YeVDoo",
      image: "images/gear/sony_zve10.jpg",
      price: "$$$",
    },
    {
      name: { en: "Sigma 16mm f/1.4", de: "Sigma 16mm f/1.4" },
      note: {
        en: "Wide 16mm prime that’s bright and sharp—great for handheld vlogs or showing full lawn scenes without distortion drama.",
        de: "Weites 16mm-Prime, lichtstark und scharf – ideal für Handheld-Vlogs oder breite Rasenszenen ohne starke Verzerrung.",
      },
      tagKey: "tag_affiliate",
      link: "https://amzn.to/4pUCqUZ",
      image: "images/gear/sigma_16mm.jpg",
      price: "$$",
    },
    {
      name: { en: "TTArtisan 35mm f/1.8", de: "TTArtisan 35mm f/1.8" },
      note: {
        en: "Compact 35mm prime with creamy bokeh for gear close-ups and talking heads. Manual focus keeps cost low and look cinematic.",
        de: "Kompaktes 35mm-Prime mit weichem Bokeh für Gear-Nahaufnahmen und Talking Heads. Manueller Fokus für Kinolook bei kleinem Budget.",
      },
      tagKey: "tag_affiliate",
      link: "https://amzn.to/4pcMzv2",
      image: "images/gear/Ttartisan_35mm.jpg",
      price: "$$",
    },
    {
      name: { en: "TTArtisan 56mm f/1.8", de: "TTArtisan 56mm f/1.8" },
      note: {
        en: "Portrait-length prime for tight shots with plenty of blur—perfect when you want products or faces to pop off the background.",
        de: "Portrait-Brennweite für enge Shots mit viel Unschärfe – perfekt, wenn Produkte oder Gesichter klar vom Hintergrund abheben sollen.",
      },
      tagKey: "tag_affiliate",
      link: "https://amzn.to/3YbFT5B",
      image: "images/gear/Ttartisan_56mm.jpg",
      price: "$$",
    },
    {
      name: { en: "Wireless mic (DJI Mic 1)", de: "Wireless-Mikro (DJI Mic 1)" },
      note: {
        en: "DJI Mic 1 wireless kit for clean voice capture on the move. Reliable range, compact receiver for Sony rigs, and quick clipping on shirts.",
        de: "DJI Mic 1 Wireless-Set für sauberen Ton unterwegs. Zuverlässige Reichweite, kompakter Empfänger für Sony-Setups und schnelles Anclippen an Shirts.",
      },
      tagKey: "tag_affiliate",
      link: "https://amzn.to/3LbWKCb",
      image: "images/gear/dji_mic_1.jpg",
      price: "$$",
    },
    {
      name: { en: "MacBook Air M4", de: "MacBook Air M4" },
      note: {
        en: "Light, quiet, and fast for editing clips, scripting, and uploads. Great battery life keeps you mobile on shoot days.",
        de: "Leicht, leise und schnell fürs Clipschneiden, Skripten und Uploads. Starke Akkulaufzeit hält dich an Drehtagen mobil.",
      },
      tagKey: "tag_affiliate",
      link: "https://amzn.to/4pgkKlN",
      image: "images/gear/macbook_air_m4.jpg",
      price: "$$$",
    },
  ],
  ebooks: [
    {
      name: { en: "Frühling Rasenpflege Ohne Bullshit", de: "Frühling Rasenpflege Ohne Bullshit" },
      note: {
        en: "Spring prep ebook with practical steps and product rates.",
        de: "Frühlings-Guide mit praktischen Schritten und Produktmengen.",
      },
      tagKey: "tag_pdf",
      priceId: "price_1SjdZY0YmDmRUccyqK6ia5tp",
      price: "€29.99",
      image: "images/ebooks/fruehling.png",
      viewLink: "ebook.html",
    },
  ],
  seasonal: [
    {
      name: { en: "Summer heat kit", de: "Sommer-Hitze-Kit" },
      note: {
        en: "Stress blend with light N and support nutrients for hot spells. Helps turf hold color and recover when temps spike.",
        de: "Stress-Mix mit leichtem N und Zusatznährstoffen für Hitzeperioden. Hilft, Farbe zu halten und sich bei Temperaturspitzen zu erholen.",
      },
      tagKey: "tag_now",
      link: "#",
      price: "$",
    },
    {
      name: { en: "Fungus watch pack", de: "Pilz-Check-Paket" },
      note: {
        en: "Mix of preventative and curative options so you can respond fast. Use at first signs of pressure or before long wet stretches.",
        de: "Mix aus präventiven und kurativen Optionen für schnelle Reaktionen. Einsetzen bei ersten Anzeichen oder vor langen feuchten Phasen.",
      },
      tagKey: "tag_now",
      link: "#",
      price: "$$",
    },
    {
      name: { en: "Overseed combo", de: "Nachsaat-Kombi" },
      note: {
        en: "Seed plus starter fertilizer and a simple watering plan to close gaps. Great for fall renovation or spring thickening.",
        de: "Saat mit Starterdünger und einfachem Bewässerungsplan, um Lücken zu schließen. Ideal für Herbst-Renovation oder Frühjahrsverdichtung.",
      },
      tagKey: "tag_fall",
      link: "#",
      price: "$$",
    },
  ],
};

const testimonials = [
  {
    name: "Casey P.",
    quote: {
      en: "Starter Stripe Kit + the weekly checklist = neighbors asking who my lawn guy is.",
      de: "Starter Stripe Kit + Wochen-Checkliste = Nachbarn fragen, wer mein Rasenprofi ist.",
    },
  },
  {
    name: "Marcus L.",
    quote: {
      en: "Followed the Rescue plan after a drought. Back to green in 3 weeks. The picks are legit.",
      de: "Nach Dürre den Rescue-Plan befolgt. Nach 3 Wochen wieder grün. Die Picks sind echt.",
    },
  },
  {
    name: "Jenna R.",
    quote: {
      en: "Love that he lists pet-safe options. Clear instructions, zero overwhelm.",
      de: "Mag die haustierfreundlichen Optionen. Klare Anweisungen, keine Überforderung.",
    },
  },
];

const faqs = [
  {
    q: {
      en: "Are these affiliate links?",
      de: "Sind das Affiliate-Links?",
    },
    a: {
      en: "Yes, some are. I only list products I personally use. Affiliate links keep the content free.",
      de: "Ja, manche. Ich liste nur Produkte, die ich selbst nutze. Affiliate-Links halten den Content kostenlos.",
    },
  },
  {
    q: {
      en: "Which kit should I start with?",
      de: "Mit welchem Kit soll ich starten?",
    },
    a: {
      en: "If you just want tidy cuts, start with the Starter Stripe Kit. For bold stripes, go Pro Striping.",
      de: "Für saubere Schnitte: Starter Stripe Kit. Für kräftige Streifen: Pro Striping.",
    },
  },
  {
    q: {
      en: "Are the fertilizers pet-safe?",
      de: "Sind die Dünger haustierfreundlich?",
    },
    a: {
      en: "I flag pet-friendly options. Always follow label re-entry times and water in when required.",
      de: "Haustierfreundliche Optionen sind markiert. Immer Wiedereinstiegszeiten beachten und einwässern, wenn nötig.",
    },
  },
  {
    q: {
      en: "Do you ship products?",
      de: "Versendest du Produkte?",
    },
    a: {
      en: "Links point to retailers I trust. Orders ship from them; my guides are instant downloads.",
      de: "Links führen zu Händlern, denen ich vertraue. Versand erfolgt über sie; meine Guides sind Sofort-Downloads.",
    },
  },
];

const reviewSeeds = [];

const $ = (s, scope = document) => scope.querySelector(s);
const $$ = (s, scope = document) => Array.from(scope.querySelectorAll(s));

let currentLang = "en";
let reviews = [];

function applyStaticTranslations(lang) {
  const dict = translations[lang] || translations.en;
  $$("[data-i18n]").forEach((el) => {
    const key = el.dataset.i18n;
    if (dict[key]) el.innerHTML = dict[key];
  });
  $$("[data-i18n-placeholder]").forEach((el) => {
    const key = el.dataset.i18nPlaceholder;
    if (dict[key]) el.placeholder = dict[key];
  });
}

function escapeHtml(str = "") {
  const safe = String(str);
  return safe
    .replace(/&/g, "&amp;")
    .replace(/</g, "&lt;")
    .replace(/>/g, "&gt;")
    .replace(/"/g, "&quot;")
    .replace(/'/g, "&#39;");
}

function formatDate(timestamp) {
  const date = new Date(timestamp || Date.now());
  if (Number.isNaN(date.getTime())) return "";
  const locale = currentLang === "de" ? "de-DE" : "en-US";
  return date.toLocaleDateString(locale, { month: "short", day: "numeric", year: "numeric" });
}

function renderReviewSkeletons(count = 3) {
  const list = $("#reviewsList");
  const empty = $("#reviewsEmpty");
  if (!list) return;
  const placeholders = Array.from({ length: count })
    .map(
      () => `
      <div class="review-skeleton">
        <div class="skeleton-pill skeleton"></div>
        <div class="skeleton-line skeleton"></div>
        <div class="skeleton-line skeleton short"></div>
      </div>`
    )
    .join("");
  list.innerHTML = placeholders;
  if (empty) empty.classList.add("hidden");
}

let toastStackEl;
function ensureToastStack() {
  if (toastStackEl) return toastStackEl;
  const stack = document.createElement("div");
  stack.className = "toast-stack";
  document.body.appendChild(stack);
  toastStackEl = stack;
  return toastStackEl;
}

function showToast(message, type = "success") {
  const stack = ensureToastStack();
  const toast = document.createElement("div");
  toast.className = `toast${type === "error" ? " error" : ""}`;
  toast.textContent = message;
  stack.appendChild(toast);
  setTimeout(() => {
    toast.style.opacity = "0";
    toast.style.transform = "translateY(-6px)";
    setTimeout(() => toast.remove(), 220);
  }, 3200);
}

async function loadReviews() {
  renderReviewSkeletons();
  try {
    const res = await fetch("/api/reviews");
    if (!res.ok) throw new Error(`Failed to load reviews: ${res.status}`);
    const data = await res.json().catch(() => ({}));
    if (Array.isArray(data.reviews)) {
      reviews = data.reviews.map((r) => ({
        name: String(r.name || "Guest").slice(0, 80),
        text: typeof r.text === "string" ? r.text.slice(0, 800) : "",
        createdAt: r.createdAt || Date.now(),
        rating: Number(r.rating) || 0,
      }));
    } else {
      reviews = [];
    }
  } catch (err) {
    console.warn("Review load failed", err);
    reviews = [];
  }
  renderReviews();
}

function getReviewText(entry) {
  if (!entry || entry.text == null) return "";
  if (typeof entry.text === "string") return entry.text;
  if (typeof entry.text === "object") {
    return entry.text[currentLang] || entry.text.en || Object.values(entry.text)[0] || "";
  }
  return "";
}

function starDisplay(rating = 0) {
  const count = Math.max(0, Math.min(5, Math.round(rating)));
  const filled = Array.from({ length: count }, () => '<span class="star-filled">★</span>').join("");
  const empty = Array.from({ length: 5 - count }, () => '<span class="star-empty">★</span>').join("");
  return filled + empty;
}

function renderReviews() {
  const list = $("#reviewsList");
  const empty = $("#reviewsEmpty");
  const ticker = $("#reviewsTicker");
  const tickerTrack = $("#reviewsTickerTrack");
  if (!list) return;
  if (!reviews.length) {
    list.innerHTML = "";
    if (empty) empty.classList.remove("hidden");
    if (ticker) ticker.classList.add("hidden");
    if (tickerTrack) tickerTrack.innerHTML = "";
    return;
  }

  const mainCards = reviews.slice(0, 3);
  const overflow = reviews.slice(3);

  const mainHtml = mainCards
    .map((r) => {
      const name = escapeHtml(r.name || "Guest");
      const text = escapeHtml(getReviewText(r));
      const formatted = text.replace(/\n/g, "<br>");
      const dateLabel = formatDate(r.createdAt);
      const stars = starDisplay(r.rating);
      return `
        <div class="review-card">
          <div class="review-meta">
            <span class="review-name">${name}</span>
            <span class="review-date">${dateLabel}</span>
          </div>
          <div class="star-display" aria-hidden="true">${stars}</div>
          <p class="review-text">${formatted}</p>
        </div>
      `;
    })
    .join("");

  list.innerHTML = mainHtml;
  if (empty) empty.classList.add("hidden");

  if (ticker && tickerTrack) {
    if (overflow.length) {
      const tickerHtml = overflow
        .map((r) => {
          const name = escapeHtml(r.name || "Guest");
          const text = escapeHtml(getReviewText(r)).slice(0, 220);
          const formatted = text.replace(/\n/g, " ");
          const dateLabel = formatDate(r.createdAt);
          const stars = starDisplay(r.rating);
          return `
            <div class="ticker-item">
              <span class="review-name">${name}</span>
              <span class="review-date">${dateLabel}</span>
              <div class="star-display" aria-hidden="true">${stars}</div>
              <p class="review-text">${formatted}</p>
            </div>
          `;
        })
        .join("");
      tickerTrack.innerHTML = tickerHtml + tickerHtml;
      ticker.classList.remove("hidden");
      tickerTrack.classList.toggle("running", true);
    } else {
      ticker.classList.add("hidden");
      tickerTrack.innerHTML = "";
      tickerTrack.classList.remove("running");
    }
  }
}

async function addReview(name, comment, rating) {
  const cleanComment = (comment || "").trim();
  const cleanName = (name || "").trim() || "Guest";
  if (!cleanComment) return false;
  const dict = translations[currentLang] || translations.en;
  const payload = {
    name: cleanName.slice(0, 80),
    comment: cleanComment.slice(0, 800),
    rating: Math.max(0, Math.min(5, Math.round(Number(rating) || 0))),
  };
  try {
    const res = await fetch("/api/reviews", {
      method: "POST",
      headers: { "Content-Type": "application/json" },
      body: JSON.stringify(payload),
    });
    const data = await res.json().catch(() => ({}));
    if (!res.ok) {
      throw new Error(data.error || `Review save failed (${res.status})`);
    }
    if (data && data.review) {
      reviews.unshift({
        name: data.review.name || payload.name,
        text: data.review.text || payload.comment,
        createdAt: data.review.createdAt || Date.now(),
        rating: data.review.rating || payload.rating,
      });
      reviews = reviews.slice(0, 30);
      renderReviews();
    } else {
      await loadReviews();
    }
    showToast(dict.reviews_status || "Thanks! Your comment is live.");
    return true;
  } catch (err) {
    console.warn("Review submit failed", err);
    const status = $("#reviewStatus");
    if (status) {
      status.textContent = err.message || "Could not post your review. Please try again.";
      status.classList.remove("hidden");
    }
    showToast(err.message || "Could not post your review. Please try again.", "error");
    return false;
  }
}

function initReviewForm() {
  const form = $("#reviewForm");
  const status = $("#reviewStatus");
  const starsWrap = $("#reviewStars");
  const hiddenRating = $("#reviewRating");
  if (!form) return;
  if (starsWrap && hiddenRating) {
    if (!hiddenRating.value || Number(hiddenRating.value) <= 0) {
      hiddenRating.value = 5;
    }
    starsWrap.addEventListener("click", (e) => {
      const btn = e.target.closest(".star");
      if (!btn) return;
      const value = Number(btn.dataset.value) || 5;
      hiddenRating.value = value;
      $$(".star", starsWrap).forEach((star) => {
        star.classList.toggle("active", Number(star.dataset.value) <= value);
      });
    });
    const defaultValue = Number(hiddenRating.value) || 5;
    $$(".star", starsWrap).forEach((star) => {
      star.classList.toggle("active", Number(star.dataset.value) <= defaultValue);
    });
  }
  form.addEventListener("submit", async (e) => {
    e.preventDefault();
    const nameInput = $("#reviewName");
    const commentInput = $("#reviewComment");
    const ratingInput = $("#reviewRating");
    const name = nameInput ? nameInput.value : "";
    const comment = commentInput ? commentInput.value : "";
    const rating = ratingInput ? ratingInput.value : 5;
    const added = await addReview(name, comment, rating);
    if (!added) {
      if (status) {
        status.textContent = "Could not post your review. Please try again.";
        status.classList.remove("hidden");
      }
      return;
    }
    renderReviews();
    if (status) {
      const msg = (translations[currentLang] || translations.en).reviews_status;
      status.textContent = msg || "";
      status.classList.remove("hidden");
    }
    form.reset();
  });
}

function toggleNav() {
  const toggle = $(".nav-toggle");
  const links = $("#navLinks");
  if (!toggle || !links) return;
  toggle.addEventListener("click", () => links.classList.toggle("open"));
  $$("nav a").forEach((a) => a.addEventListener("click", () => links.classList.remove("open")));
  document.addEventListener("click", (e) => {
    if (!links.classList.contains("open")) return;
    const clickInsideNav = links.contains(e.target);
    const clickToggle = toggle.contains(e.target);
    if (!clickInsideNav && !clickToggle) links.classList.remove("open");
  });
}

function initActiveNav() {
  const sections = ["hero", "catalog", "highlights", "reviews", "faq", "contact"];
  const links = sections
    .map((id) => {
      const el = document.getElementById(id);
      const navLink = document.querySelector(`nav a[href="#${id}"]`);
      return el && navLink ? { el, navLink } : null;
    })
    .filter(Boolean);
  if (!links.length) return;
  const observer = new IntersectionObserver(
    (entries) => {
      entries.forEach((entry) => {
        const match = links.find((l) => l.el === entry.target);
        if (!match) return;
        match.navLink.classList.toggle("active", entry.isIntersecting);
      });
    },
    { threshold: 0.3 }
  );
  links.forEach(({ el }) => observer.observe(el));
}

function renderProducts() {
  const mapping = [
    ["toolsGrid", products.tools],
    ["consumablesGrid", products.consumables],
    ["videoGrid", products.videoGear],
    ["ebooksGrid", products.ebooks],
  ];
  const dict = translations[currentLang] || translations.en;
  mapping.forEach(([id, items]) => {
    const grid = document.getElementById(id);
    if (!grid) return;
    grid.innerHTML = items
      .map((item) => {
        const name = item.name[currentLang] || item.name.en;
        const note = item.note[currentLang] || item.note.en;
        const tag = dict[item.tagKey] || translations.en[item.tagKey] || "";
        const view = dict.product_view || "View";
        const buy = dict.product_buy || "Buy";
        const initial = (name || "").trim().charAt(0) || "?";
        const safeInitial = escapeHtml(initial);
        const photoClass = item.imageClass ? ` ${item.imageClass}` : "";
        const imageBlock = item.image
          ? `<div class="product-photo${photoClass}" data-initial="${safeInitial}"><img src="${item.image}" alt="${name}" loading="lazy"></div>`
          : `<div class="product-photo placeholder${photoClass}"><span>${safeInitial}</span></div>`;
        const hasViewLink = Boolean(item.viewLink);
        const hasBuy = Boolean(item.priceId);
        const action = hasViewLink || hasBuy
          ? `<div class="product-actions">
              ${hasViewLink ? `<a class="btn btn-ghost view-link" href="${item.viewLink}">${view}</a>` : ""}
              ${
                hasBuy
                  ? `<button class="btn btn-primary checkout-btn" data-price="${item.priceId}">${buy}</button>`
                  : item.link
                  ? `<a class="btn btn-ghost view-link" href="${item.link}">${view}</a>`
                  : ""
              }
            </div>`
          : `<a class="btn btn-ghost view-link" href="${item.link}">${view}</a>`;
        return `
        <div class="product-card">
          ${imageBlock}
          <strong>${name}</strong>
          <p class="muted">${note}</p>
          ${action}
        </div>
      `;
      })
      .join("");
    initCheckoutButtons();
    attachImageFallbacks();
  });
}

function renderTestimonials() {
  const grid = $("#testimonialsGrid");
  if (!grid) return;
  grid.innerHTML = testimonials
    .map((t) => {
      const quote = t.quote[currentLang] || t.quote.en;
      return `
      <div class="card hero-bubble">
        <p>"${quote}"</p>
        <p class="muted">- ${t.name}</p>
      </div>
    `;
    })
    .join("");
}

function attachImageFallbacks() {
  $$(".product-photo img").forEach((img) => {
    img.addEventListener(
      "error",
      () => {
        const parent = img.parentElement;
        if (!parent) return;
        const initial = parent.dataset.initial || "?";
        parent.innerHTML = `<span>${escapeHtml(initial)}</span>`;
        parent.classList.add("placeholder");
      },
      { once: true }
    );
  });
}

function forceProductLinksNewTab() {
  $$(".product-card a").forEach((a) => {
    if (!a) return;
    if (a.classList.contains("view-link")) return;
    if (!a.target || a.target === "_self") a.target = "_blank";
    const existingRel = a.getAttribute("rel") || "";
    const relParts = new Set(existingRel.split(/\s+/).filter(Boolean));
    relParts.add("noopener");
    relParts.add("noreferrer");
    a.setAttribute("rel", Array.from(relParts).join(" "));
  });
}

function initLightbox() {
  let overlay = document.querySelector(".lightbox");
  if (!overlay) {
    overlay = document.createElement("div");
    overlay.className = "lightbox";
    overlay.innerHTML = `
      <button class="lightbox-close" aria-label="Close">×</button>
      <img alt="Product preview" />
    `;
    document.body.appendChild(overlay);
  }
  const imgTarget = overlay.querySelector("img");
  const closeBtn = overlay.querySelector(".lightbox-close");
  const close = () => overlay.classList.remove("open");
  overlay.addEventListener("click", (e) => {
    if (e.target === overlay) close();
  });
  if (closeBtn) closeBtn.addEventListener("click", close);
  document.addEventListener("keydown", (e) => {
    if (e.key === "Escape") close();
  });
  document.body.addEventListener("click", (e) => {
    const target = e.target.closest(".product-photo img");
    if (!target) return;
    e.preventDefault();
    if (imgTarget) {
      imgTarget.src = target.src;
      imgTarget.alt = target.alt || "Product image";
    }
    overlay.classList.add("open");
  });
}

function renderFaq() {
  const list = $("#faqList");
  if (!list) return;
  list.innerHTML = faqs
    .map((f) => {
      const q = f.q[currentLang] || f.q.en;
      const a = f.a[currentLang] || f.a.en;
      return `
      <div class="faq-item">
        <h4>${q}</h4>
        <p>${a}</p>
      </div>
    `;
    })
    .join("");
}

function initForms() {
  const contactForm = $("#contactForm");
  const contactStatus = $("#contactStatus");
  if (contactForm) {
    contactForm.addEventListener("submit", (e) => {
      e.preventDefault();
      const data = new FormData(contactForm);
      if (data.get("trap")) return;
      const msg = (translations[currentLang] || translations.en).contact_status;
      if (contactStatus) {
        contactStatus.textContent = msg || "";
        contactStatus.classList.remove("hidden");
      }
      showToast(msg || "Thanks! I will reply within 48 hours.");
      contactForm.reset();
    });
  }

  const newsletterForm = $("#newsletterForm");
  const newsletterStatus = $("#newsletterStatus");
  if (newsletterForm) {
    newsletterForm.addEventListener("submit", (e) => {
      e.preventDefault();
      const msg = (translations[currentLang] || translations.en).newsletter_status;
      if (newsletterStatus) {
        newsletterStatus.textContent = msg || "";
        newsletterStatus.classList.remove("hidden");
      }
      showToast(msg || "Checklist is on the way.");
      newsletterForm.reset();
    });
  }
}

function setLanguage(lang) {
  currentLang = lang === "de" ? "de" : "en";
  document.documentElement.lang = currentLang;
  document.documentElement.dataset.lang = currentLang;
  applyStaticTranslations(currentLang);
  renderProducts();
  renderFaq();
  renderReviews();
  const dict = translations[currentLang] || translations.en;
  const contactStatus = $("#contactStatus");
  if (contactStatus && !contactStatus.classList.contains("hidden")) {
    contactStatus.textContent = dict.contact_status || contactStatus.textContent;
  }
  const newsletterStatus = $("#newsletterStatus");
  if (newsletterStatus && !newsletterStatus.classList.contains("hidden")) {
    newsletterStatus.textContent = dict.newsletter_status || newsletterStatus.textContent;
  }
  const reviewStatus = $("#reviewStatus");
  if (reviewStatus && !reviewStatus.classList.contains("hidden")) {
    reviewStatus.textContent = dict.reviews_status || reviewStatus.textContent;
  }
  $$(".lang-btn").forEach((btn) => {
    btn.classList.toggle("active", btn.dataset.lang === currentLang);
  });
  forceProductLinksNewTab();
}

function initLanguageToggle() {
  const switcher = $("#langSwitch");
  if (!switcher) return;
  switcher.addEventListener("click", (e) => {
    const btn = e.target.closest(".lang-btn");
    if (!btn) return;
    const next = btn.dataset.lang === "de" ? "de" : "en";
    setLanguage(next);
  });
}

async function startCheckout(priceId, btn) {
  if (!priceId) return;
  const originalText = btn.textContent;
  btn.disabled = true;
  btn.textContent = "...";
  try {
    const res = await fetch("/api/checkout", {
      method: "POST",
      headers: { "Content-Type": "application/json" },
      body: JSON.stringify({ priceId }),
    });
    const data = await res.json();
    if (data.url) {
      window.location.href = data.url;
    } else {
      alert(data.error || "Unable to start checkout.");
    }
  } catch (err) {
    console.error(err);
    alert("Checkout failed. Please try again.");
  } finally {
    btn.disabled = false;
    btn.textContent = originalText;
  }
}

function initCheckoutButtons() {
  $$(".checkout-btn").forEach((btn) => {
    btn.addEventListener("click", () => startCheckout(btn.dataset.price, btn));
  });
}

function initScrollReveal() {
  const targets = [
    ".hero",
    ".strip",
    ".catalog-group",
    ".product-card",
    ".why-grid .card",
    ".promo-band",
    ".reviews-list",
    ".faq-item",
    ".ebook-hero",
    ".ebook-card",
    ".ebook-offer-card",
    ".cta-card",
  ];
  const nodes = $$(targets.join(","));
  if (!nodes.length) return;
  const observer = new IntersectionObserver(
    (entries) => {
      entries.forEach((entry) => {
        if (entry.isIntersecting) {
          entry.target.classList.add("visible");
        } else {
          entry.target.classList.remove("visible");
        }
      });
    },
    { threshold: 0.1, rootMargin: "0px 0px -5% 0px" }
  );
  nodes.forEach((node, idx) => {
    node.classList.add("reveal");
    node.style.animationDelay = `${Math.min(idx * 0.05, 0.4)}s`;
    observer.observe(node);
  });
}

function initFloatingAccents() {
  const configs = [
    { top: "10%", left: "6%", size: 360, speed: 0.06, scale: 1 },
    { top: "55%", left: "72%", size: 420, speed: 0.08, scale: 1.05 },
    { bottom: "10%", right: "8%", size: 380, speed: 0.1, scale: 0.95 },
  ];
  const accents = configs.map((cfg) => {
    const blob = document.createElement("span");
    blob.className = "floating-accent";
    blob.style.width = `${cfg.size}px`;
    blob.style.height = `${cfg.size}px`;
    blob.style.top = cfg.top || "auto";
    blob.style.left = cfg.left || "auto";
    blob.style.bottom = cfg.bottom || "auto";
    blob.style.right = cfg.right || "auto";
    blob.dataset.speed = cfg.speed;
    blob.dataset.scale = cfg.scale;
    document.body.appendChild(blob);
    return blob;
  });

  const applyParallax = () => {
    const y = window.scrollY || 0;
    accents.forEach((blob) => {
      const speed = Number(blob.dataset.speed) || 0.08;
      const base = Number(blob.dataset.scale) || 1;
      blob.style.transform = `translate3d(0, ${-y * speed}px, 0) scale(${base})`;
    });
  };

  window.addEventListener("scroll", () => requestAnimationFrame(applyParallax), { passive: true });
  applyParallax();
}

document.addEventListener("DOMContentLoaded", () => {
  toggleNav();
  initActiveNav();
  initLanguageToggle();
  initForms();
  loadReviews();
  initReviewForm();
  setLanguage("de");
  initCheckoutButtons();
  initScrollReveal();
  initFloatingAccents();
  initLightbox();
});
